

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyuq">
  <meta name="keywords" content="">
  
    <meta name="description" content="JavaScript的发展史JavaScript的发展壮大在JavaScript诞生之初只是作为一个脚本语言来使用，主要是做一些简单的表单校验等，因为代码量不多，所以是直接跟html写在一个文件里面，并且用script标签包裹 12345&#x2F;&#x2F; index.html&lt;script&gt;    var name &#x3D; &amp;#x27;shiyuq&amp;#x27;    var age &#x3D; 18&lt;&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈CJS和ESM">
<meta property="og:url" content="https://shiyuq.github.io/2025/09/12/hello-world/index.html">
<meta property="og:site_name" content="shiyuq">
<meta property="og:description" content="JavaScript的发展史JavaScript的发展壮大在JavaScript诞生之初只是作为一个脚本语言来使用，主要是做一些简单的表单校验等，因为代码量不多，所以是直接跟html写在一个文件里面，并且用script标签包裹 12345&#x2F;&#x2F; index.html&lt;script&gt;    var name &#x3D; &amp;#x27;shiyuq&amp;#x27;    var age &#x3D; 18&lt;&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-12T08:33:50.710Z">
<meta property="article:modified_time" content="2025-09-15T09:10:35.893Z">
<meta property="article:author" content="shiyuq">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>浅谈CJS和ESM - shiyuq</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"shiyuq.github.io","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>shiyuq</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://fluid.s3.bitiful.net/bg/vdysjx.png?w=1920&fmt=webp') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="浅谈CJS和ESM"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-09-12 16:33" pubdate>
          2025年9月12日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          104 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">浅谈CJS和ESM</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="JavaScript的发展史"><a href="#JavaScript的发展史" class="headerlink" title="JavaScript的发展史"></a>JavaScript的发展史</h3><h4 id="JavaScript的发展壮大"><a href="#JavaScript的发展壮大" class="headerlink" title="JavaScript的发展壮大"></a>JavaScript的发展壮大</h4><p>在JavaScript诞生之初只是作为一个脚本语言来使用，主要是做一些简单的表单校验等，因为代码量不多，所以是直接跟html写在一个文件里面，并且用script标签包裹</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">// index.html<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>但是随着业务越来越复杂，尤其在ajax出现后代码量飞速增长，开发者们纷纷将JavaScript代码写到单独的js文件中，与html文件解耦，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// index.html</span><br>&lt;script src=<span class="hljs-string">&#x27;./index.js&#x27;</span>&gt;&lt;/script&gt;<br><br><span class="hljs-comment">// index.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br></code></pre></td></tr></table></figure>

<p>再后来，多个开发者都将自己的js文件引入到一个html文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// index.html</span><br>&lt;script src=<span class="hljs-string">&#x27;./index.js&#x27;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;./index-shiyuq1.js&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;./index-shiyuq2.js&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="hljs-comment">// index.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><br><span class="hljs-comment">// index-shiyuq1.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;faker&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">28</span><br><br><span class="hljs-comment">// index-shiyuq2.js</span><br><span class="hljs-keyword">var</span> <span class="hljs-title function_">name</span> = (<span class="hljs-params">name</span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`hello <span class="hljs-subst">$&#123;name&#125;</span>`</span><br>&#125;<br><span class="hljs-keyword">var</span> <span class="hljs-title function_">age</span> = (<span class="hljs-params">age</span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> age + <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>不难发现，问题已经稍有眉头了，此时用哪个文件中的变量完全就取决于谁引用在最下面（在调用它之前），如果在不同文件中变量的类型还不一致，就会导致程序直接崩溃，这种从某种程度上来讲也属于<strong>全局变量污染</strong>，开发者的噩梦就此来临</p>
<h4 id="模块化的出现"><a href="#模块化的出现" class="headerlink" title="模块化的出现"></a>模块化的出现</h4><p>为了解决全局变量污染的问题，开发者开始使用命名空间的方法，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// index.html</span><br>&lt;script src=<span class="hljs-string">&#x27;./index.js&#x27;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;./index-shiyuq1.js&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;./index-shiyuq2.js&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="hljs-comment">// index.js</span><br>app.<span class="hljs-property">module</span> = &#123;&#125;<br>app.<span class="hljs-property">module</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br>app.<span class="hljs-property">module</span>.<span class="hljs-property">age</span> = <span class="hljs-number">18</span><br><br><span class="hljs-comment">// index-shiyuq1.js</span><br>app.<span class="hljs-property">moduleA</span> = &#123;&#125;<br>app.<span class="hljs-property">moduleA</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;faker&#x27;</span><br>app.<span class="hljs-property">moduleA</span>.<span class="hljs-property">age</span> = <span class="hljs-number">28</span><br><br><span class="hljs-comment">// index-shiyuq2.js</span><br>app.<span class="hljs-property">moduleB</span> = &#123;&#125;<br>app.<span class="hljs-property">moduleB</span>.<span class="hljs-property">name</span> = <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`hello <span class="hljs-subst">$&#123;name&#125;</span>`</span><br>&#125;<br>app.<span class="hljs-property">moduleB</span>.<span class="hljs-property">age</span> = <span class="hljs-function">(<span class="hljs-params">age</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> age + <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>此时，已经有隐隐约约的模块化的概念了，只不过是用命名空间来实现的。但还是有个隐性问题，<code>index-shiyuq1.js</code>的文件作者可以很方便的通过<code>app.module.name</code>来获取到模块<code>index.js</code>中的name，当然也可以很方便的去修改它，但是修改却让<code>index.js</code>毫不知情。这是不允许发生的！</p>
<p>接着，聪明的开发者们又想到了JavaScript的函数作用域，振臂一呼，用<strong>闭包</strong>可以解决现在的问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// index.html</span><br>&lt;script src=<span class="hljs-string">&quot;./index.js&quot;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./index-shiyuq1.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./index-shiyuq2.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br><span class="hljs-comment">// index.js</span><br>app.<span class="hljs-property">module</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">getName</span>: <span class="hljs-function">() =&gt;</span> name,<br>        <span class="hljs-attr">getAge</span>: <span class="hljs-function">() =&gt;</span> age<br>    &#125;<br>&#125;)()<br><br><span class="hljs-comment">// index-shiyuq1.js</span><br>app.<span class="hljs-property">moduleA</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;faker&#x27;</span><br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">28</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">getName</span>: <span class="hljs-function">() =&gt;</span> name,<br>        <span class="hljs-attr">getAge</span>: <span class="hljs-function">() =&gt;</span> age<br>    &#125;<br>&#125;)()<br><br><span class="hljs-comment">// index-shiyuq2.js</span><br>app.<span class="hljs-property">moduleB</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params">name, age</span>) &#123;<br>    <span class="hljs-keyword">var</span> name = name<br>    <span class="hljs-keyword">var</span> age = age<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">getName</span>: <span class="hljs-function">() =&gt;</span> name,<br>        <span class="hljs-attr">getAge</span>: <span class="hljs-function">() =&gt;</span> age<br>    &#125;<br>&#125;)(<span class="hljs-string">&#x27;hello shiyuq2&#x27;</span>, <span class="hljs-number">28</span> + <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p>现在<code>index-shiyuq2.js</code>可以通过<code>app.moduleA.getName()</code>来获取到模块A中的名字，但是各个模块的名字都保存在各自的函数里面，无法修改，但是由于模块的加载有先后顺序，模块B可以访问模块A，但是模块A却无法访问模块B</p>
<p>所以模块化，不仅要处理全局变量污染，数据的保护，还要解决模块间的依赖关系</p>
<h3 id="CommonJS应运而生"><a href="#CommonJS应运而生" class="headerlink" title="CommonJS应运而生"></a>CommonJS应运而生</h3><p>为了解决上面出现的一系列问题，所以需要制定模块化的规范，CommonJS就是新的规范，下面来讲解以下CommonJS大致的作用</p>
<h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>node应用是由模块组成，采用了CommonJS规范，每个文件就是一个模块，有自己的作用域，且在一个文件中定义的变量、函数和类都是私有的，对其他文件不可见</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// index.js</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">28</span><br><span class="hljs-keyword">var</span> <span class="hljs-title function_">getAge</span> = (<span class="hljs-params">val</span>) =&gt; val - <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure>

<p>上面的age和getAge都是当前index.js文件私有的，但是如果你想要在多个文件中分享变量，可以使用<code>global</code>关键字</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">global</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br></code></pre></td></tr></table></figure>

<p>虽然但是，不推荐！</p>
<p>CommonJS规范规定：每个模块内部有两个变量可以使用，分别是<code>require</code>和<code>module</code></p>
<p>require：用来加载一些模块</p>
<p>module：代表的是当前模块，是一个对象且上面保存了当前模块的信息。然后它上面有一个<code>exports</code>属性，保存着当前模块要导出的接口或者变量，使用<code>require</code>加载其他模块获取的值其实就是module上面的exports属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">age</span> = <span class="hljs-number">18</span><br><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>) <span class="hljs-comment">// 使用require加载a模块</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">name</span>) <span class="hljs-comment">// shiyuq</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">age</span>) <span class="hljs-comment">// 18</span><br></code></pre></td></tr></table></figure>

<h4 id="CommonJS——exports"><a href="#CommonJS——exports" class="headerlink" title="CommonJS——exports"></a>CommonJS——exports</h4><p>为了方便，nodejs在实现CommonJS规范的时候，为每个模块都提供了一个<code>exports</code>的私有变量，指向了<code>module.exports</code>，于是你可以理解为exports和module.exports都指向了一个内存地址，所以你给exports中添加属性的同时，module.exports的数据也会同步变化，相当于在每个模块开始的地方，加入了下面一行代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-built_in">exports</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span><br></code></pre></td></tr></table></figure>

<p>所以上面的代码也可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = <span class="hljs-number">18</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>warning</strong>:</p>
<p>由于exports是模块内部的私有局部变量，它是指向了module.exports的地址，所以你直接对他赋值是不可取的，这相当于改变了此变量的内存地址！！！</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><span class="hljs-built_in">exports</span> = name <span class="hljs-comment">// 这个是不可以的哦，因为你想要导出的肯定是name和age两个属性，现在会导致你实际并未往module.exports上赋值</span><br></code></pre></td></tr></table></figure>

<p>请看下面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = &#123;<span class="hljs-attr">exports</span>: &#123;&#125;&#125;<br><span class="hljs-keyword">var</span> <span class="hljs-built_in">exports</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span>) <span class="hljs-comment">// &#123;&#125;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>) <span class="hljs-comment">// &#123;&#125;</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><span class="hljs-built_in">exports</span> = name<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span>) <span class="hljs-comment">// shiyuq</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>) <span class="hljs-comment">// &#123;&#125;</span><br></code></pre></td></tr></table></figure>

<p>同样，如果你对module.exports重新赋值，也是需要注意的地方</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = name<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>) <span class="hljs-comment">// &#123;name: &#x27;shiyuq&#x27;&#125;</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-string">&#x27;hello shiyuq&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>) <span class="hljs-comment">// &#x27;hello shiyuq&#x27;</span><br></code></pre></td></tr></table></figure>

<p><strong>建议</strong>：可以只使用一种导出的方式，建议使用module.exports，写在每个模块的结尾</p>
<h4 id="CommonJS的实现"><a href="#CommonJS的实现" class="headerlink" title="CommonJS的实现"></a>CommonJS的实现</h4><p>我们先了解以下CommonJS的一些模块的特点：</p>
<blockquote>
<p>1：所有的代码都运行在模块的作用域，不会污染全局作用域</p>
<p>2：模块可以多次加载，但只会在第一次加载时运行一次，之后缓存运行结果，以后再次加载，直接读取缓存结果，想要让模块再次运行，需要清除缓存</p>
<p>3：模块加载的顺序，按照其在代码中出现的顺序</p>
</blockquote>
<p>在了解了CommonJS的一些关键规范和特点后，我们不难发现CommonJS的主要使用的技术，离不开三个关键字，就是<code>exports</code>，<code>module</code>和<code>require</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = name<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = age<br><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">name</span>) <span class="hljs-comment">// shiyuq</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">age</span>) <span class="hljs-comment">// 18</span><br><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;jenny&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">17</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = name<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = age<br><br><span class="hljs-comment">// c.js</span><br><span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;b.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b.<span class="hljs-property">name</span>) <span class="hljs-comment">// jenny</span><br></code></pre></td></tr></table></figure>

<p>所以结合第一部分咱们对于Javascript的解析后，不难写出CommonJS的简易实现（使用立即执行函数），将require、exports、module三个参数传入，再把模块代码放入立即执行函数中，模块的导出值放在module.exports中，这样就实现了模块的加载，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>    <span class="hljs-comment">// b.js</span><br>    <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">name</span>) <span class="hljs-comment">// shiyuq</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">name</span>) <span class="hljs-comment">// 18</span><br>    <br>    <span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;jenny&#x27;</span><br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">17</span><br>    <span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = name<br>    <span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = age<br>&#125;)(<span class="hljs-variable language_">module</span>, <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-built_in">require</span>)<br></code></pre></td></tr></table></figure>

<p>知道了CommonJS的实现原理后，就很容易可以把规范的项目代码转换成浏览器支持的代码，例如咱们熟知的webpack，咱们以webpack为例，看看使用webpack构建的时候，主要做了哪些工作？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// bundle.js</span><br>(<span class="hljs-keyword">function</span>(<span class="hljs-params">modules</span>) &#123;<br>    <span class="hljs-comment">// 模块管理</span><br>&#125;)(&#123;<br>    <span class="hljs-string">&#x27;a.js&#x27;</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>        <span class="hljs-comment">// a.js 的文件内容</span><br>    &#125;,<br>	<span class="hljs-string">&#x27;b.js&#x27;</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>        <span class="hljs-comment">// b.js 的文件内容</span><br>    &#125;,<br>    <span class="hljs-string">&#x27;c.js&#x27;</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>        <span class="hljs-comment">// c.js 的文件内容</span><br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>接下来，我们需要按照CommonJS的规范，实现模块管理中的内容，然后，我们知道加载过的模块会被缓存，所以我们需要一个对象来缓存加载过的模块，然后需要一个require函数来加载模块，在加载的时候需要生成一个module，并且module上需要有一个exports属性，用来接收模块导出的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// bundle.js</span><br>(<span class="hljs-keyword">function</span>(<span class="hljs-params">modules</span>) &#123;<br>    <span class="hljs-comment">// 模块管理</span><br>    <span class="hljs-keyword">var</span> cachedModules = &#123;&#125;<br>    <span class="hljs-comment">// 加载模块的方法</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-built_in">require</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">moduleName</span>) &#123;<br>        <span class="hljs-comment">// 如果已经有了缓存，直接返回</span><br>        <span class="hljs-keyword">if</span> (cachedModules[moduleName]) <span class="hljs-keyword">return</span> cachedModules[moduleName].<span class="hljs-property">exports</span><br>        <br>        <span class="hljs-comment">// 如果没有加载，就生成一个module，并且放入到cachedModules中</span><br>        <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = &#123;<br>            moduleName,<br>            <span class="hljs-attr">exports</span>: &#123;&#125;<br>        &#125;<br>        cachedModules[moduleName] = <span class="hljs-variable language_">module</span><br>        <br>        <span class="hljs-comment">// 执行要加载的模块</span><br>        <span class="hljs-comment">// 这里的call只是把this指向到了当前的module.exports，然后会把所有的模块中导出的内容自动加载到module的exports属性上</span><br>        modules[moduleName].<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-variable language_">module</span>, <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-built_in">require</span>)<br>        <br>        <span class="hljs-comment">// 最后返回module.exports</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>)<br>&#125;)(&#123;<br>    <span class="hljs-string">&#x27;a.js&#x27;</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>        <span class="hljs-comment">// a.js 的文件内容</span><br>    &#125;,<br>	<span class="hljs-string">&#x27;b.js&#x27;</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>        <span class="hljs-comment">// b.js 的文件内容</span><br>    &#125;,<br>    <span class="hljs-string">&#x27;c.js&#x27;</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>        <span class="hljs-comment">// c.js 的文件内容</span><br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>所以上面基本已经实现了CommonJS的核心规范</p>
<h4 id="require文件的加载流程"><a href="#require文件的加载流程" class="headerlink" title="require文件的加载流程"></a>require文件的加载流程</h4><p>咱们上面已经讲过了require文件的时候，文件会有缓存，那么咱们一般在开发的时候，会有三种类型，通常是核心模块、文件模块以及第三方模块，那么require在加载的时候，遵循什么规律呢？</p>
<p>核心模块：像fs、http、path等等，都会被识别为nodejs的核心模块</p>
<p>文件模块：像是使用<code>./</code>、<code>../</code>作为相对路径的文件模块，<code>/</code>作为绝对路径的文件模块</p>
<p>第三方模块：非路径形式并且也是非核心模块的模块，被称为第三方模块，比如咱们常用的lodash、moment等等</p>
<p>其中核心模块的加载速度最快，因为已经被编译成二进制代码；而文件模块由于第一次加载会被缓存，所以第二次加载的时候也会很快；所以咱们需要关注的是第三方模块的加载，加载顺序如下：</p>
<ul>
<li>首先是在当前的node_modules目录查找</li>
<li>如果没有，在父级目录的node_modules中查找，如果没有，继续向上查找</li>
<li>沿着路径递归，直至根目录下的node_modules</li>
<li>如果没有，提示模块未找到（module *** not found）</li>
</ul>
<p>那既然知道了require是如何引入模块的，那么我们来看下面这个问题：<strong>循环引入</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;b.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;我是a文件&#x27;</span>)<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">sayHi</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">b</span>())<br>&#125;<br><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;我是b文件&#x27;</span>)<br><span class="hljs-keyword">var</span> userInfo = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;shiyuq&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span><br>&#125;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">() =&gt;</span> userInfo<br><br><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>)<br><span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;b.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;我是入口文件&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>接下来大家可以在终端中输入<code>node main.js</code>，运行结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">我是b文件<br>我是a文件<br>我是入口文件<br></code></pre></td></tr></table></figure>

<p>所以从上面的运行结果，不难看出CommonJS在分析模块的加载阶段，采用的是深度优先遍历，执行的顺序是父-&gt;子-&gt;父，但是要注意的是在b.js模块还没有加载完成的时候，此时在b.js模块中是没有a模块的sayHi方法的，因为a模块还没有导出sayHi方法【如果你循环引用了，就会出现这样的问题，这在我们的工作中，已经是令人非常头疼的存在】</p>
<h3 id="其他模块化方案"><a href="#其他模块化方案" class="headerlink" title="其他模块化方案"></a>其他模块化方案</h3><p>我们学习了CommonJS的模块化规范，知道了它的模块加载机制是同步的，这在服务端是可行的，但是在浏览器端，难免会出现页面假死，阻塞后续代码执行，为了解决这个问题，所以后面又发展了一些其他的模块化规范</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>后端</td>
<td>CommonJS</td>
<td>Node.js</td>
</tr>
<tr>
<td>前端</td>
<td>AMD</td>
<td>RequireJS</td>
</tr>
<tr>
<td></td>
<td>CMD</td>
<td>Sea.js</td>
</tr>
<tr>
<td>前后端</td>
<td>ES6 Modules</td>
<td>ES6</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>因为本来对于前端没有进行深入的研究，个人看法是一开始出现的RequireJS其实就是为了解决CommonJS规范不能用于浏览器的问题，而AMD就是RequireJS在推广过程中对模块定义规范化的产出；而后面出现的sea.js，是由于有人觉得AMD规范是异步的，不够自然和垂直，所以创造了sea.js，大家可以像nodejs一样书写模块代码，随之而然形成了CMD规范</p>
<p>CommonJS是服务于服务端的，AMD和CMD是服务于客户端的，但是他们都有一个共同点，就是只有在代码运行后才能确定导出的内容，所以从es6开始，ES6 Module将会取代其他规范，成为两端通用的模块解决方案</p>
<h3 id="ES6-Module"><a href="#ES6-Module" class="headerlink" title="ES6 Module"></a>ES6 Module</h3><p>从ES6开始，在语言标准的层面，就实现了模块化功能，具体可以看<a target="_blank" rel="noopener" href="https://es6.ruanyifeng.com/#docs/module">阮一峰ES6 Module</a></p>
<p>ES6模块的设计思想是尽可能的静态化，是的编译的时候就能确定模块的依赖关系，输入和输出的变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// CommonJS</span><br><span class="hljs-keyword">const</span> &#123;stat, exists, readFile&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><br><span class="hljs-comment">// 等同于</span><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> &#123;stat, exists, readFile&#125; = fs<br></code></pre></td></tr></table></figure>

<p>实际CommonJS是去加载了整个模块，然后生成了一个对象，最后再从该对象上取到我们需要的方法，这种也叫做运行时加载，也就是在程序运行起来的时候才能得到这个对象，而ES6模块不是对象，而是通过export命令显式指定输出的代码，再通过import命令输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// es6</span><br><span class="hljs-keyword">import</span> &#123;stat, exists, readFile&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span><br></code></pre></td></tr></table></figure>

<h4 id="export和import"><a href="#export和import" class="headerlink" title="export和import"></a>export和import</h4><p>export：规定模块的对外接口</p>
<p>import：输入其他模块提供的功能</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> age = <span class="hljs-number">20</span><br><br><span class="hljs-comment">// 也可以这么写；推荐使用，因为你可以在模块的结尾很清楚的知道你导出了哪些变量</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">20</span><br><span class="hljs-built_in">exports</span> &#123;<br>    name,<br>    age<br>&#125;<br></code></pre></td></tr></table></figure>

<p>你还可以重命名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 输出函数getName</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getName</span> (name) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello&#x27;</span> + name<br>&#125;<br><br><span class="hljs-comment">// 你还可以这样</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getAge</span> () &#123;&#125;<br><br><span class="hljs-keyword">export</span> &#123;<br>	getAge <span class="hljs-keyword">as</span> getAgeNew<br>&#125;<br></code></pre></td></tr></table></figure>

<p>但是你需要特别注意，export命令规定必须与模块内部的变量建立一一对应的关系</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 错误</span><br><span class="hljs-keyword">export</span> <span class="hljs-number">1</span><br><span class="hljs-comment">// 错误</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">export</span> name<br></code></pre></td></tr></table></figure>

<p>上面实际导出的都是一个值，没有对应关系</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 建立name和shiyuq的对应关系</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><br><span class="hljs-comment">// 建立name和shiyuq的对应关系</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">export</span> &#123;name&#125;<br><br><span class="hljs-comment">// 建立name和shiyuq的对应关系</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br><span class="hljs-keyword">export</span> &#123;name <span class="hljs-keyword">as</span> nameNew&#125;<br><br><span class="hljs-comment">// 错误</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">export</span> f<br><br><span class="hljs-comment">// 建立f变量和函数的对应关系</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) &#123;&#125;<br><br><span class="hljs-comment">// 建立f变量和函数的对应关系</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">export</span> &#123;f&#125;<br></code></pre></td></tr></table></figure>

<p>需要注意的是，export可以出现在模块的任何位置，只要处于模块的顶层，如果处于块级作用域，将会报错</p>
<p>使用了export命令定义了模块的对外接口后，其他的模块可以通过import命令加载这个模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">import</span> &#123;name, age&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br><br><span class="hljs-comment">// 重命名</span><br><span class="hljs-keyword">import</span> &#123;name <span class="hljs-keyword">as</span> nameNew, age&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br></code></pre></td></tr></table></figure>

<p>要注意，import命令具有提升效果，会放到整个模块的顶部，首先执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name)<br><span class="hljs-keyword">import</span> &#123;name&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br></code></pre></td></tr></table></figure>

<p>因为import命令是编译阶段执行的，在代码运行之前</p>
<p>由于import是静态执行，所以不可以使用表达式和变量（他们只能在代码运行的时候才有具体的结果）</p>
<p>我们还可以整体加载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">name</span>) <span class="hljs-comment">// shiyuq</span><br></code></pre></td></tr></table></figure>

<p>从上面可以看出使用import的时候，用户需要知道所要加载的变量名或者函数名，否则无法加载，所以为了方便用户，我们可以使用<code>export default</code>命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;shiyuq&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>上面是默认输出的一个匿名函数，我们可以在其他模块中这么使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br><span class="hljs-title function_">a</span>() <span class="hljs-comment">// shiyuq</span><br></code></pre></td></tr></table></figure>

<p>所以我们常常会在源码中看到以下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span><br><br><span class="hljs-comment">// 同时输入默认方法和其他变量</span><br><span class="hljs-keyword">import</span> _, &#123;each&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span><br><br><span class="hljs-comment">//对应的export语句</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) &#123;&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">each</span>(<span class="hljs-params">obj, iterator, context</span>) &#123;&#125;<br><br><span class="hljs-keyword">export</span> &#123;each <span class="hljs-keyword">as</span> forEach&#125;<br><br><span class="hljs-comment">// 如果你想输出默认值</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-number">18</span><br><span class="hljs-comment">// 这里实际是有一个default变量，然后把18赋值给了变量default，所以没有报错</span><br></code></pre></td></tr></table></figure>

<h4 id="模块加载的实质"><a href="#模块加载的实质" class="headerlink" title="模块加载的实质"></a>模块加载的实质</h4><p>CommonJS模块输出的是一个值的浅拷贝，而ES6模块输出的是值的引用，它在遇到import命令时，不去执行模块，而是生成一个动态的只读引用，等真的需要用到的时候再去模块中取值，所以ES6时动态引用，并不会缓存值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 举个栗子</span><br><span class="hljs-keyword">let</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span> <span class="hljs-comment">// 值引用</span><br><span class="hljs-keyword">const</span> <span class="hljs-built_in">exports</span> = &#123;<span class="hljs-attr">name</span>: name&#125; <span class="hljs-comment">// 此时开辟了一个堆内存存储并且赋值给exports变量</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span>) <span class="hljs-comment">// shiyuq</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;jenny&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span>) <span class="hljs-comment">// jenny</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name) <span class="hljs-comment">// shiyuq</span><br><br><span class="hljs-comment">// 再看一个</span><br><span class="hljs-keyword">let</span> <span class="hljs-variable language_">module</span> = &#123;<span class="hljs-attr">exports</span>: &#123;&#125;&#125;<br><span class="hljs-keyword">const</span> moduleA = (<span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>    <span class="hljs-keyword">let</span> name = <span class="hljs-string">&#x27;shiyuq&#x27;</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">setName</span> = (<span class="hljs-params">n</span>) =&gt; name = n<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getName</span> = (<span class="hljs-params"></span>) =&gt; name<br>	<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>		name,<br>        setName,<br>        getName<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span><br>&#125;)(<span class="hljs-variable language_">module</span>, <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, &#123;&#125;)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(moduleA) <span class="hljs-comment">// &#123;name: &#x27;shiyuq&#x27;, getName: f, setName: f&#125;</span><br><br>moduleA.<span class="hljs-title function_">getName</span>() <span class="hljs-comment">// shiyuq</span><br>moduleA.<span class="hljs-property">name</span> <span class="hljs-comment">// shiyuq</span><br><br>moduleA.<span class="hljs-title function_">setName</span>(<span class="hljs-string">&#x27;jenny&#x27;</span>)<br>moduleA.<span class="hljs-title function_">getName</span>() <span class="hljs-comment">// jenny</span><br>moduleA.<span class="hljs-property">name</span> <span class="hljs-comment">// shiyuq</span><br></code></pre></td></tr></table></figure>

<p>现在大家应该了解了为什么内部的变化不会影响到外部的值了，但是这个也仅仅只是针对的原始值，如果是引用值那就会跟着变化了</p>
<p>但是ES6的模块运行机制和CommonJS不一样，它在遇到import时，只是生成一个动态的只读引用，有点像linux里面的软链接，如果原始值变了，import输入的值也会跟着变化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> counter = <span class="hljs-number">3</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">incCounter</span>(<span class="hljs-params"></span>) &#123;<br>    counter++<br>&#125;<br><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">import</span> &#123;counter, incCounter&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter) <span class="hljs-comment">// 3</span><br><span class="hljs-title function_">incCounter</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter) <span class="hljs-comment">// 4</span><br></code></pre></td></tr></table></figure>

<p>可见ES6模块不会缓存运行结果，而是动态获取</p>
<h4 id="ES6模块的循环加载"><a href="#ES6模块的循环加载" class="headerlink" title="ES6模块的循环加载"></a>ES6模块的循环加载</h4><p>ES6模块是动态引用，所以那些变量并不会被缓存，而是成为一个指向被加载模块的引用，只要你作为开发者能确保它真的能取到值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">import</span> &#123;bar&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;b.js&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;a.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> foo = <span class="hljs-string">&#x27;foo&#x27;</span><br><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">import</span> &#123;foo&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;a.js&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;b.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> bar = <span class="hljs-string">&#x27;bar&#x27;</span><br></code></pre></td></tr></table></figure>

<p>上面a模块中引用b，b模块中引用a，造成循环引用，现在执行<code>node a.js</code>查看运行结果</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.js</span><br>ReferenceError: foo is not defined<br></code></pre></td></tr></table></figure>

<p>这是因为在执行a模块的时候，其中引入了b模块，去b模块中加载，首先打印b.js，然后打印foo，但是此时a模块中并未输出foo接口，所以报错</p>
<p>大家也可以写一个 简单的demo，测试一下ES6打包后的代码，这样可以更加清晰的了解ES6和CommonJS的不同之处</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>浅谈CJS和ESM</div>
      <div>https://shiyuq.github.io/2025/09/12/hello-world/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyuq</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年9月12日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/09/12/%E4%B8%8A%E6%89%8Bnestjs/" title="上手nestjs">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">上手nestjs</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
